<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Presentation Coach</title>
  <style>
    body {
      box-sizing: border-box;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      margin: 0;
      padding: 20px;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      color: #333;
    }
    .container {
      max-width: 400px;
      margin: 0 auto;
      background: white;
      border-radius: 20px;
      padding: 30px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.1);
    }
    .header { text-align: center; margin-bottom: 30px; }
    .header h1 { color: #667eea; margin: 0 0 10px; font-size: 28px; font-weight: 700; }
    .header p { color: #666; margin: 0; font-size: 16px; }
    .record-section { text-align: center; margin: 30px 0; }
    .record-btn {
      width: 120px; height: 120px; border-radius: 50%; border: none;
      background: linear-gradient(135deg, #ff6b6b, #ee5a24);
      color: white; font-size: 18px; font-weight: 600; cursor: pointer;
      transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(255, 107, 107, 0.3);
      display: flex; align-items: center; justify-content: center;
      margin: 0 auto 20px auto;
    }
    .record-btn:hover { transform: translateY(-2px); }
    .record-btn.recording { background: linear-gradient(135deg, #ff4757, #c44569); animation: pulse 2s infinite; }
    .record-btn.processing { background: linear-gradient(135deg, #ffa726, #ff9800); cursor: not-allowed; }
    @keyframes pulse { 0%{transform:scale(1);}50%{transform:scale(1.05);}100%{transform:scale(1);} }
    .timer { font-size: 24px; font-weight: 600; color: #667eea; margin-bottom: 20px; }
    .status { font-size: 16px; color: #666; margin-bottom: 20px; }
    .feedback-section { margin-top: 30px; display: none; }
    .feedback-section.show { display: block; }
    .feedback-card {
      background: #f8f9ff; border-radius: 15px; padding: 20px; margin-bottom: 15px;
      border-left: 4px solid #667eea;
    }
    .feedback-title { font-size: 18px; font-weight: 600; color: #667eea; margin-bottom: 10px; }
    .metric { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid #e0e6ff; }
    .metric:last-child { border-bottom: none; }
    .metric-label { font-weight: 500; color: #555; }
    .metric-value { font-weight: 600; color: #667eea; }
    .suggestions { background: #fff3cd; border-radius: 10px; padding: 15px; margin-top: 15px; border-left: 4px solid #ffc107; }
    .suggestions h4 { margin: 0 0 10px; color: #856404; font-size: 16px; }
    .suggestions ul { margin: 0; padding-left: 20px; color: #856404; }
    .error { background: #f8d7da; color: #721c24; padding: 15px; border-radius: 10px; margin: 20px 0; text-align: center; }
    .download-btn {
      background: linear-gradient(135deg, #28a745, #20c997);
      color: white; border: none; padding: 12px 24px; border-radius: 25px;
      font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px;
    }
    .reset-btn {
      background: #6c757d; color: white; border: none; padding: 10px 20px; border-radius: 20px;
      font-size: 14px; cursor: pointer; margin-top: 10px; width: 100%;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="header">
      <h1>Presentation Coach</h1>
      <p>Record yourself and get instant feedback</p>
    </div>

    <div class="record-section">
      <button id="recordBtn" class="record-btn"><span id="recordText">Start Recording</span></button>
      <div id="timer" class="timer">00:00</div>
      <div id="status" class="status">Ready to record</div>
    </div>

    <div id="error" class="error" style="display:none;"></div>

<div id="cards" class="error" style="display:none;">
    <div id="feedbackSection" class="feedback-section">
      <div class="feedback-card">
        <div class="feedback-title">Speech Analysis</div>
        <div class="metric"><span class="metric-label">Duration</span><span id="duration" class="metric-value">-</span></div>
        <div class="metric"><span class="metric-label">Words per minute</span><span id="wpm" class="metric-value">-</span></div>
        <div class="metric"><span class="metric-label">Filler words</span><span id="fillers" class="metric-value">-</span></div>
        <div class="metric"><span class="metric-label">Pauses</span><span id="pauses" class="metric-value">-</span></div>
      </div>
      <div class="feedback-card">
        <div class="feedback-title">Performance Score</div>
        <div class="metric"><span class="metric-label">Overall Rating</span><span id="score" class="metric-value">-</span></div>
        <div class="metric"><span class="metric-label">Pace</span><span id="paceRating" class="metric-value">-</span></div>
        <div class="metric"><span class="metric-label">Clarity</span><span id="clarityRating" class="metric-value">-</span></div>
      </div>
      <div id="suggestions" class="suggestions">
        <h4>Suggestions for Improvement</h4>
        <ul id="suggestionsList"></ul>
      </div>
</div>
      <button id="downloadBtn" class="download-btn">Save Recording</button>
      <button id="resetBtn" class="reset-btn">New Recording</button>
    </div>

    <div id="transcription" class="feedback-card" style="display:none;">
      <div class="feedback-title">üìù Transcription</div>
      <p id="transcriptText">-</p>
    </div>
  </div>


<script>
let mediaRecorder, audioChunks = [], startTime, timerInterval, audioBlob;
let isRecording = false, liveStream = null;
let recognition, transcript = '';

const recordBtn = document.getElementById('recordBtn');
const recordText = document.getElementById('recordText');
const timer = document.getElementById('timer');
const status = document.getElementById('status');
const feedbackSection = document.getElementById('feedbackSection');
const errorDiv = document.getElementById('error');
const downloadBtn = document.getElementById('downloadBtn');
const resetBtn = document.getElementById('resetBtn');

function initSpeechRecognition() {
  if (!('webkitSpeechRecognition' in window || 'SpeechRecognition' in window)) {
    console.warn("Speech Recognition not supported.");
    return;
  }
  const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
  recognition = new SpeechRecognition();
  recognition.lang = 'en-US';
  recognition.continuous = false;
  recognition.interimResults = false;
  recognition.onresult = function(e) {
    transcript = e.results[0][0].transcript;
    document.getElementById('transcriptText').textContent = transcript;
    document.getElementById('transcription').style.display = "block";
  };
}

async function initializeApp() {
  try {
    if (!navigator.mediaDevices?.getUserMedia) throw new Error('No audio support');
    if (!window.MediaRecorder) throw new Error('MediaRecorder not supported');
    status.textContent = 'Ready to record';
  } catch (err) { showError(err.message); }
}

recordBtn.addEventListener('click', toggleRecording);
downloadBtn.addEventListener('click', downloadRecording);
resetBtn.addEventListener('click', resetApp);

async function toggleRecording() {
  if (!isRecording) await startRecording();
  else stopRecording();
}

async function startRecording() {
  try {
    liveStream = await navigator.mediaDevices.getUserMedia({audio:true});
    mediaRecorder = new MediaRecorder(liveStream);
    audioChunks = [];
    mediaRecorder.ondataavailable = e => audioChunks.push(e.data);
    mediaRecorder.onstop = () => {
      audioBlob = new Blob(audioChunks, { type: mediaRecorder.mimeType });
      if (liveStream) { liveStream.getTracks().forEach(t=>t.stop()); liveStream=null; }
      analyzeRecording();
    };
    mediaRecorder.start();
    isRecording = true;
    startTime = Date.now();
    recordBtn.classList.add('recording');
    recordText.textContent = 'Stop Recording';
    status.textContent = 'Recording...';
    startTimer(); hideError();
  } catch(err){ showError('Mic access denied'); }
}

function stopRecording() {
  if (mediaRecorder && isRecording) {
    mediaRecorder.stop();
    isRecording = false;
    recordBtn.classList.remove('recording');
    recordBtn.classList.add('processing');
    recordText.textContent = 'Processing...';
    status.textContent = 'Analyzing...';
    clearInterval(timerInterval);
    if (recognition) recognition.start();
  }
}

function startTimer() {
  timerInterval = setInterval(() => {
    const elapsed = Date.now() - startTime;
    const m = Math.floor(elapsed/60000), s = Math.floor((elapsed%60000)/1000);
    timer.textContent = `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
  },1000);
}

function analyzeRecording() {
  const duration = (Date.now()-startTime)/1000, minutes = duration/60;
  const wordCount = Math.floor(duration*(120+Math.random()*60));
  const wpm = Math.round(wordCount/minutes);
  const fillerCount = Math.floor(wordCount*(0.02+Math.random()*0.08));
  const pauseCount = Math.floor(duration/(8+Math.random()*12));
  let paceRating = (wpm<100?"Too Slow":(wpm>200?"Too Fast":"Good"));
  let fillerPct = fillerCount/wordCount*100;
  let clarity = fillerPct>8?"Needs Work":(fillerPct>5?"Good":"Excellent");
  let score = 85; if (wpm<100||wpm>200) score-=10; if(fillerPct>5) score-=15; if(fillerPct>8) score-=10;

  document.getElementById('duration').textContent=`${Math.floor(duration/60)}:${Math.floor(duration%60).toString().padStart(2,'0')}`;
  document.getElementById('wpm').textContent=wpm;
  document.getElementById('fillers').textContent=`${fillerCount} (${fillerPct.toFixed(1)}%)`;
  document.getElementById('pauses').textContent=pauseCount;
  document.getElementById('score').textContent=`${score}/100`;
  document.getElementById('paceRating').textContent=paceRating;
  document.getElementById('clarityRating').textContent=clarity;

  const suggs=[]; if(wpm<100)suggs.push('Try speaking faster'); if(wpm>200)suggs.push('Slow down');
  if(fillerPct>5)suggs.push('Reduce filler words'); if(pauseCount<3)suggs.push('Add pauses'); if(duration<30)suggs.push('Practice longer');
  suggs.push('Maintain eye contact','Use gestures','Vary tone');
  const list=document.getElementById('suggestionsList'); list.innerHTML=''; suggs.forEach(s=>{let li=document.createElement('li'); li.textContent=s; list.appendChild(li);});

  recordBtn.classList.remove('processing'); recordText.textContent='Start Recording'; status.textContent='Analysis complete!'; feedbackSection.classList.add('show');
}

function downloadRecording() {
  if (!audioBlob) return;
  const url = URL.createObjectURL(audioBlob); const a=document.createElement('a'); a.href=url;
  let ext='webm'; if(audioBlob.type.includes('ogg')) ext='ogg'; else if(audioBlob.type.includes('wav')) ext='wav';
  a.download=`presentation-${new Date().toISOString().slice(0,19).replace(/:/g,'-')}.${ext}`;
  document.body.appendChild(a); a.click(); document.body.removeChild(a); URL.revokeObjectURL(url);
  status.textContent='Recording saved!';
}

function resetApp() {
  isRecording=false; audioChunks=[]; audioBlob=null;
  if(liveStream){ liveStream.getTracks().forEach(t=>t.stop()); liveStream=null; }
  recordBtn.classList.remove('recording','processing'); recordText.textContent='Start Recording'; timer.textContent='00:00'; status.textContent='Ready to record'; feedbackSection.classList.remove('show');
  if(timerInterval)clearInterval(timerInterval); hideError();
}

function showError(m){ errorDiv.textContent=m; errorDiv.style.display='block'; }
function hideError(){ errorDiv.style.display='none'; }

initSpeechRecognition();
initializeApp();
</script>
</body>
</html>
